# 高度なテンプレート

複雑な機能を含むskill向けの高度なテンプレートです。

## 構造

```yaml
---
name: advanced-skill
description: 複雑な機能を持つskillの説明。具体的な使用シーンを明記。
disable-model-invocation: true  # 手動実行のみ（推奨）
context: fork                   # サブエージェントで実行
agent: general-purpose          # または Explore, Plan など
allowed-tools:
  - Bash
  - Read
  - Write
  - Grep
  - AskUserQuestion
---

# Advanced Skill

このskillの概要説明。

## 機能概要

### 主要機能

1. **機能A**: 説明
2. **機能B**: 説明
3. **機能C**: 説明

### 対応するユースケース

- ユースケース1
- ユースケース2
- ユースケース3

## 引数と設定

### 引数の扱い

\`$ARGUMENTS\`: すべての引数
\`$ARGUMENTS[0]\` または \`$1\`: 最初の引数
\`$ARGUMENTS[1]\` または \`$2\`: 2番目の引数

### 引数パターン

引数に応じた動作:

- \`$1 = "create"\`: 新規作成モード
- \`$1 = "update"\`: 更新モード
- \`$1 = "delete"\`: 削除モード

## 動的コンテキスト挿入

### 現在の状態取得

プロジェクトの現在の状態:

\`\`\`
現在のブランチ: !\`git branch --show-current\`
変更されたファイル: !\`git status --short\`
最新のコミット: !\`git log -1 --oneline\`
\`\`\`

### ファイル内容の埋め込み

設定ファイルの内容:

\`\`\`
!\`cat config/settings.json\`
\`\`\`

## 対話型プロセス

### ステップ1: 情報収集

AskUserQuestionで必要な情報を収集:

質問1: 「操作の種類は?」
- オプション: 作成、更新、削除

質問2: 「対象は?」
- オプション: ファイル、ディレクトリ、設定

### ステップ2: 検証

収集した情報を検証:

1. 入力値のバリデーション
2. 既存状態の確認
3. 依存関係のチェック

### ステップ3: 実行

検証後、実際の処理を実行:

\`\`\`bash
# 例: ファイル作成
mkdir -p path/to/directory
touch path/to/file.ts
\`\`\`

### ステップ4: 確認

実行結果を確認し、報告:

\`\`\`
処理完了: !\`ls -la path/to/\`
\`\`\`

## エラーハンドリング

### エラーチェック

各ステップでエラーをチェック:

\`\`\`bash
if [ $? -ne 0 ]; then
  echo "エラーが発生しました"
  exit 1
fi
\`\`\`

### ロールバック

エラー発生時のロールバック手順:

1. 変更を元に戻す
2. 状態を復元
3. エラーメッセージを表示

## サブエージェント実行

\`context: fork\` により、このskillは独立したサブエージェントで実行されます。

### メリット

- メインコンテキストを汚染しない
- 安全な実験環境
- 並列実行が可能

### 注意点

- サブエージェントは親コンテキストを引き継ぐ
- 結果は親に返される
- 長時間実行に適している

## 外部スクリプトの活用

### スクリプトファイル

複雑な処理は専用スクリプトに:

**scripts/process.sh**:
\`\`\`bash
#!/bin/bash
# 複雑な処理

set -e  # エラー時に停止

echo "処理を開始..."
# ... 処理 ...
echo "完了"
\`\`\`

### SKILL.mdから呼び出し

\`\`\`bash
chmod +x scripts/process.sh
./scripts/process.sh "$1" "$2"
\`\`\`

または動的コンテキスト挿入:

\`\`\`
!\`./scripts/process.sh "$1" "$2"\`
\`\`\`

## サポートファイル構成

### ディレクトリ構造

\`\`\`
advanced-skill/
├── SKILL.md              # メイン
├── overview.md           # 概要
├── detailed-guide.md     # 詳細ガイド
├── examples/             # サンプル
│   ├── example1.md
│   └── example2.md
├── templates/            # テンプレート
│   └── template.ts
└── scripts/              # スクリプト
    ├── process.sh
    └── validate.sh
\`\`\`

### ファイル参照

**概要が必要な場合**:
\`\`\`
詳細は \`overview.md\` を参照。
\`\`\`

**常に必要な場合**:
\`\`\`
!\`cat overview.md\`
\`\`\`

**条件付き**:
\`\`\`
高度な使い方については、\`$1\`が\`advanced\`の場合に\`detailed-guide.md\`を参照。
\`\`\`

## 動作モード

### 対話モード

ユーザーとの対話を通じて進行:

1. AskUserQuestionで情報収集
2. 選択肢を提示
3. 確認を求める

### 自動モード

引数から情報を取得し、自動実行:

\`\`\`
$1 = "auto" の場合、対話をスキップ
\`\`\`

### デバッグモード

詳細なログを出力:

\`\`\`bash
if [ "$DEBUG" = "true" ]; then
  set -x  # コマンドをエコー
fi
\`\`\`

## ベストプラクティス

### 1. 段階的開示

SKILL.mdは高レベルの指示のみ:

\`\`\`markdown
# Advanced Skill

## 基本的な使い方
（ここに簡潔な説明）

## 詳細
詳細なガイドは \`detailed-guide.md\` を参照。

## 高度な使い方
高度な機能は \`advanced-usage.md\` を参照。
\`\`\`

### 2. 適切な自由度

タスクに応じて指示の具体性を調整:

- **創造的タスク**: 高自由度（テキスト指示）
- **標準的タスク**: 中自由度（擬似コード）
- **重要な操作**: 低自由度（具体的なスクリプト）

### 3. エラー耐性

すべてのステップでエラーチェック:

\`\`\`bash
set -e  # エラー時に停止
set -u  # 未定義変数使用時に停止
set -o pipefail  # パイプラインのエラーを検出
\`\`\`

### 4. ドキュメント

各機能にドキュメントを含める:

- 何をするか
- なぜそうするか
- どう使うか
- エラー時の対処法

## テスト戦略

### 単体テスト

個別の機能をテスト:

\`\`\`bash
# スクリプトのテスト
bash scripts/test-process.sh
\`\`\`

### 統合テスト

全体のワークフローをテスト:

1. 初期状態の準備
2. Skillの実行
3. 結果の検証
4. クリーンアップ

### エッジケース

異常系のテスト:

- 不正な引数
- 欠落したファイル
- 権限エラー

## パフォーマンス最適化

### コンテキスト効率

- 必要な情報のみロード
- 大きなファイルは遅延読み込み
- キャッシュを活用

### 並列実行

独立したタスクは並列実行:

\`\`\`bash
task1 &
task2 &
wait
\`\`\`

## セキュリティ

### 入力検証

すべての入力を検証:

\`\`\`bash
if [[ ! "$1" =~ ^[a-zA-Z0-9_-]+$ ]]; then
  echo "不正な入力"
  exit 1
fi
\`\`\`

### 安全な実行

危険なコマンドは確認を求める:

\`\`\`
このコマンドは\`$TARGET\`を削除します。
本当に実行しますか? (yes/no)
\`\`\`

## デバッグ

### ログ出力

重要なポイントでログを出力:

\`\`\`bash
echo "DEBUG: 変数の値 = $VAR"
\`\`\`

### トレース

実行トレースを有効化:

\`\`\`bash
set -x  # デバッグモード
\`\`\`

## まとめ

このテンプレートは以下の機能を含む高度なskillに適しています:

- 複雑な対話プロセス
- 動的コンテキスト挿入
- サブエージェント実行
- 外部スクリプト活用
- 段階的開示
- エラーハンドリング
- セキュリティ考慮

プロジェクトの要件に応じてカスタマイズしてください。

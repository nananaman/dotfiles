# Skill作成のベストプラクティス

このドキュメントは、高品質なClaude Code skillを作成するための詳細なガイドラインです。

## 1. Description設計

`description`はskillの最も重要な要素です。Claudeがskillをいつ呼び出すかを判断する唯一の情報源となります。

### 優れたDescriptionの構造

**必須要素**:
1. **何を**: skillが提供する機能
2. **いつ**: どんな状況で使うべきか

**形式**:
```
[機能の説明]。[使用シーン1]、[使用シーン2]、[使用シーン3]に使用。
```

### 良い例

```yaml
description: Claude Code用の新しいskillを作成するためのガイド。skillの目的、構造、ベストプラクティスを統合。新しいskillを作りたいとき、既存skillを改善したいとき、skillの作り方を学びたいときに使用。
```

**理由**:
- 明確な機能説明（「新しいskillを作成するためのガイド」）
- 具体的な使用シーン（「新しいskillを作りたいとき」など）
- トリガーワードを含む（「skill」「作成」「改善」）

### 悪い例

```yaml
description: skillを作るツール
```

**問題点**:
- 使用シーンが不明
- トリガーワードが不足
- 曖昧すぎて自動呼び出しが困難

### キーワード選択のコツ

1. **具体的な動詞**: 「作成」「デプロイ」「分析」「生成」など
2. **ドメイン用語**: 「API」「コンポーネント」「テスト」など
3. **状況ワード**: 「新しい」「既存」「複雑な」など
4. **問題ワード**: 「エラー」「失敗」「最適化」など

### トリガーメカニズムの理解

Claudeは以下の情報を組み合わせてskillを選択:
- ユーザーのメッセージ内容
- 現在のコンテキスト
- Skillのdescription
- 過去の会話履歴

**最適化のポイント**: ユーザーが自然に使う言葉をdescriptionに含める。

## 2. 自由度の設定

タスクの性質に応じて、指示の具体性レベルを調整します。

### 高自由度（テキスト指示）

**使用場面**:
- 複数のアプローチが有効
- 創造性が必要
- プロジェクト固有のパターンがある

**例**:
```markdown
コンポーネントを作成する際:
- 単一責任の原則に従う
- プロップスを型安全にする
- 再利用性を重視する
```

**利点**: 柔軟性、適応性
**欠点**: 一貫性が低い可能性

### 中自由度（擬似コード / パラメータ付きスクリプト）

**使用場面**:
- 推奨パターンがある
- ある程度の柔軟性も必要
- エラーが許容される

**例**:
```markdown
APIエンドポイントを作成:
1. バリデーションスキーマを定義
2. ハンドラー関数を実装
3. エラーハンドリングを追加
4. テストケースを作成

バリデーションには `zod` を使用。
エラーは `ApiError` クラスでラップ。
```

**利点**: バランスの取れたガイダンス
**欠点**: 状況判断が必要

### 低自由度（具体的なスクリプト）

**使用場面**:
- 脆弱でエラーが許されない操作
- 完全に決定的な処理
- 複雑な手順の自動化

**例**:
```markdown
本番デプロイを実行:

!`./scripts/deploy.sh production`

スクリプトは以下を自動実行:
1. テストスイート実行
2. ビルド作成
3. デプロイターゲットへプッシュ
4. ヘルスチェック
```

**利点**: 一貫性、信頼性
**欠点**: 柔軟性がない

### 自由度選択のガイドライン

| タスクの性質 | 推奨自由度 | 理由 |
|------------|----------|------|
| UI/UXデザイン | 高 | 創造性と適応性が必要 |
| API設計 | 中 | パターンがあるが柔軟性も必要 |
| データベースマイグレーション | 低 | エラーが許されない |
| コード生成 | 中〜高 | プロジェクト依存 |
| デプロイ | 低 | 決定的な手順が必要 |

## 3. コンテキスト効率性

トークンは貴重なリソース。各情報の「コスト対効果」を意識します。

### Claudeが既に知っていること（書かない）

- プログラミング言語の基本文法
- 標準ライブラリの使い方
- 一般的なフレームワークの基礎
- 広く知られたベストプラクティス
- 基本的なアルゴリズムとデータ構造

### Claudeが知らないこと（書くべき）

- プロジェクト固有の規約
- チーム独自のパターン
- カスタムツールの使い方
- ドメイン特有の知識
- 組織のワークフロー

### 効率的な書き方

**悪い例**（冗長）:
```markdown
関数を作成する際、適切な命名規則を使用することが重要です。
関数名は動詞で始め、明確で説明的であるべきです。
また、関数は単一の責任を持つべきで、複雑すぎてはいけません。
```

**良い例**（簡潔）:
```markdown
関数命名: `handle*`, `process*`, `validate*`
例: `handleUserLogin`, `processPayment`, `validateEmail`
```

### 具体例の活用

説明よりも例を示す方が効率的:

**悪い例**:
```markdown
エラーハンドリングは、エラーの種類に応じて適切なステータスコードを返し、
一貫したフォーマットでエラーメッセージを提供する必要があります。
```

**良い例**:
```javascript
// エラーハンドリングパターン
throw new ApiError(404, 'User not found', { userId });
throw new ApiError(400, 'Invalid input', { field: 'email' });
throw new ApiError(500, 'Database connection failed');
```

## 4. 段階的開示パターン

SKILL.mdは500行未満に保ち、詳細は別ファイルに分離します。

### パターン1: 高レベルガイド + 参照ファイル

**SKILL.md**:
```markdown
---
name: api-conventions
description: API設計パターンとコードベース規約
---

# API規約

## 基本原則
- RESTful設計
- 一貫したエラーフォーマット
- バージョニング

詳細なガイドラインは以下を参照:
- エンドポイント設計: `endpoint-design.md`
- 認証パターン: `auth-patterns.md`
- エラーハンドリング: `error-handling.md`
```

### パターン2: ドメイン別組織化

```
skill-name/
├── SKILL.md              # 概要と基本方針
├── frontend.md           # フロントエンド関連
├── backend.md            # バックエンド関連
└── database.md           # データベース関連
```

**SKILL.md**で明示的に参照:
```markdown
フロントエンド開発については `frontend.md` を参照。
```

### パターン3: 条件付き詳細

```markdown
基本的な使い方:
!`cat templates/basic-usage.md`

高度な使い方（複雑なケースのみ）:
必要に応じて `advanced-usage.md` を参照。
```

### いつロードするか

サポートファイルの参照は明示的に:

- **常に必要**: 動的コンテキスト挿入（感嘆符+バッククォート構文でファイルを読み込む）
- **条件付き**: テキストで参照を示し、Claudeが判断
- **手動**: ユーザーに読むよう促す

## 5. サポートファイルの使い方

### ファイル命名規則

- **説明的**: `error-handling.md` > `eh.md`
- **ケバブケース**: `api-conventions.md`
- **目的が明確**: `examples/`, `templates/`, `scripts/`

### ディレクトリ構成

```
skill-name/
├── SKILL.md              # メイン（必須）
├── overview.md           # 概要（オプション）
├── best-practices.md     # ベストプラクティス
├── examples/             # サンプル
│   ├── basic.md
│   └── advanced.md
├── templates/            # テンプレート
│   └── template.md
└── scripts/              # スクリプト
    └── helper.sh
```

### SKILL.mdからの参照方法

**動的挿入**（常にロード）:
```markdown
!`cat examples/basic.md`
```

**テキスト参照**（条件付きロード）:
```markdown
詳細は `best-practices.md` を参照してください。
```

**条件付き挿入**:
```markdown
現在のGitステータス:
!`git status --short`
```

### ネストの深さ

- **推奨**: 1レベルまで（SKILL.md → サポートファイル）
- **避ける**: 2レベル以上（SKILL.md → file1.md → file2.md）

**理由**: コンテキスト追跡が困難になり、トークン消費が増加

## 6. 避けるべきもの

### 余分なドキュメント

**不要なファイル**:
- `README.md`: SKILL.mdで十分
- `INSTALLATION_GUIDE.md`: skillは自動ロード
- `CHANGELOG.md`: Git履歴で十分
- `LICENSE`: 必要な場合のみ

### 冗長な説明

**避ける**:
```markdown
このskillは、あなたがアプリケーションを本番環境にデプロイする必要がある際に使用できます。
デプロイプロセスは複雑で、多くのステップを含むため、このskillがそれを自動化します。
```

**推奨**:
```markdown
本番デプロイを自動化。テスト実行、ビルド作成、デプロイ、ヘルスチェックを順次実行。
```

### 一般的な概念の説明

Claudeは以下を既に理解しています:
- RESTful API設計
- Git ワークフロー
- テスト駆動開発
- デザインパターン
- アジャイル手法

**書くべき**: プロジェクト固有の実装や規約のみ

### 過度な抽象化

**避ける**:
```markdown
エンティティ管理フレームワークにおける関係性マッピングの
メタプログラミングパラダイムを活用して...
```

**推奨**:
```markdown
モデル定義:
- `User` → `Profile` (1:1)
- `User` → `Post` (1:多)
- `Post` → `Tag` (多:多)
```

## 7. 実践的なチェックリスト

新しいskillを作成または レビューする際:

### 必須項目
- [ ] YAMLフロントマターが正しい
- [ ] descriptionに「何を」「いつ」が含まれる
- [ ] allowed-toolsが必要最小限
- [ ] SKILL.mdが500行未満

### 品質項目
- [ ] 具体例が含まれている
- [ ] 簡潔で明確な指示
- [ ] プロジェクト固有の情報のみ
- [ ] 適切な自由度の設定

### 最適化項目
- [ ] トークン効率を意識
- [ ] 段階的開示を活用
- [ ] サポートファイルが適切に組織化
- [ ] 冗長な説明を排除

### テスト項目
- [ ] 手動呼び出しが動作
- [ ] 自動呼び出しが適切
- [ ] エラーハンドリングが適切
- [ ] 実際のユースケースで検証

## 8. 継続的改善

Skillは一度作って終わりではありません:

1. **使用状況の観察**: どんな場面で呼び出されるか
2. **フィードバック収集**: うまく動作しないケース
3. **反復的改善**: descriptionやallowed-toolsの調整
4. **ドキュメント更新**: 新しいパターンやベストプラクティス

**目標**: 最小限のトークンで最大限の価値を提供するskill
